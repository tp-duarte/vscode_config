/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *--------------------------------------------------------------------------------------------*/

var wn=Object.create;var ge=Object.defineProperty;var Cn=Object.getOwnPropertyDescriptor;var xn=Object.getOwnPropertyNames;var En=Object.getPrototypeOf,qn=Object.prototype.hasOwnProperty;var h=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var He=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of xn(t))!qn.call(e,o)&&o!==r&&ge(e,o,{get:()=>t[o],enumerable:!(n=Cn(t,o))||n.enumerable});return e};var b=(e,t,r)=>(r=e!=null?wn(En(e)):{},He(t||!e||!e.__esModule?ge(r,"default",{value:e,enumerable:!0}):r,e)),kn=e=>He(ge({},"__esModule",{value:!0}),e);var me=h((gi,We)=>{We.exports=function(t,r,n){t(r),n&&n(r===!0?null:r)}});var Q=h((mi,je)=>{"use strict";var Ye=me();je.exports=function(t,r){if(!t)return function(o,i){return o?Ye(i,o,r):i(!0)};Array.isArray(t)||(t=Object.keys(t).map(function(o){return t[o]}));var n=0;return function(o,i){if(o)return Ye(i,o,r);n>=t.length?i(!0):i(null,t[n++])}}});var Ve=h((yi,ze)=>{"use strict";var Sn=Q();ze.exports=function(e){return Sn(Object.keys(e))}});var ye=h((vi,Ke)=>{"use strict";var _n=me();Ke.exports=function(t,r){return function(n,o){if(n)return _n(o,n,r);if(t!=null){var i=t;t=null,o(null,i)}else o(!0)}}});var Qe=h((wi,Ze)=>{"use strict";Ze.exports=function(t){var r=0;return t=t||1/0,function(n,o){if(n)return o&&o(n);if(r>t)return o(!0);o(null,r++)}}});var et=h((Ci,Xe)=>{"use strict";Xe.exports=function(t){return t=t||Math.random,function(r,n){return r?n&&n(r):n(null,t())}}});var rt=h((xi,tt)=>{"use strict";tt.exports=function(){return function(t,r){r(!0)}}});var ot=h((Ei,nt)=>{"use strict";nt.exports=function(t){return function(r,n){n(t)}}});var st=h((qi,it)=>{"use strict";it.exports={keys:Ve(),once:ye(),values:Q(),count:Qe(),infinite:et(),empty:rt(),error:ot()}});var D=h((ki,ut)=>{"use strict";ut.exports=function(t,r){var n,o,i;r||(i=new Error("no done callback supplied"));function c(u){if(n=u,o)return c.abort();(function s(){for(var a=!0,l=!1;a;)if(l=!1,n(null,function(f,p){if(l=!0,f=f||o){if(a=!1,r)r(f===!0?null:f);else if(f&&f!==!0)throw console.warn(i),f}else t&&t(p)===!1||o?(a=!1,n(o||!0,r||function(){})):a||s()}),!l){a=!1;return}})()}return c.abort=function(u,s){if(typeof u=="function"&&(s=u,u=!0),o=u||!0,n)return n(o,s||function(){})},c}});var lt=h((Si,ct)=>{"use strict";var Pn=D();ct.exports=function(t){return Pn(null,t)}});var at=h((_i,ft)=>{"use strict";var Fn=D();ft.exports=function(t){return Fn(function(r){console.log(r)},t)}});var N=h((Pi,pt)=>{pt.exports=function(t){return t&&(typeof t=="string"?function(r){return r[t]}:typeof t=="object"&&typeof t.exec=="function"?function(r){var n=t.exec(r);return n&&n[0]}:t)}});var gt=h((Fi,ht)=>{"use strict";function dt(e){return e}var On=N(),bn=D();ht.exports=function(t,r){var n=!1;return r?t=On(t)||dt:(r=t,t=dt),bn(function(o){if(t(o))return n=!0,r(null,o),!1},function(o){n||r(o===!0?null:o,null)})}});var X=h((Oi,mt)=>{"use strict";var Bn=D();mt.exports=function(t,r,n){n||(n=r,r=null);var o=Bn(function(i){r=t(r,i)},function(i){n(i,r)});return arguments.length===2?function(i){i(null,function(c,u){if(c)return n(c===!0?null:c);r=u,o(i)})}:o}});var ve=h((bi,yt)=>{"use strict";var Rn=X();yt.exports=function(t){return Rn(function(r,n){return r.push(n),r},[],t)}});var wt=h((Bi,vt)=>{"use strict";var An=ve();vt.exports=function(){return t=>{let r,n,o=new Promise((i,c)=>{r=i,n=c});return An((i,c)=>{i?n(i):r(c)})(t),o}}});var xt=h((Ri,Ct)=>{"use strict";var In=X();Ct.exports=function(t){return In(function(r,n){return r+n},"",t)}});var qt=h((Ai,Et)=>{"use strict";Et.exports={drain:D(),onEnd:lt(),log:at(),find:gt(),reduce:X(),collect:ve(),collectAsPromise:wt(),concat:xt()}});var St=h((Ii,kt)=>{"use strict";function Tn(e){return e}var Ln=N();kt.exports=function(t){return t?(t=Ln(t),function(r){return function(n,o){r(n,function(i,c){try{c=i?null:t(c)}catch(u){return r(u,function(){return o(u)})}o(i,c)})}}):Tn}});var Pt=h((Ti,_t)=>{"use strict";function Dn(e){return e}var Nn=N();_t.exports=function(t){if(!t)return Dn;t=Nn(t);var r=!1,n,o;return function(i){return function c(u,s){if(o)return s(o);u?(o=u,r?i(u,function(a){r?n=s:s(u)}):i(u,function(a){s(u)})):i(null,function(a,l){a?s(a):o?s(o):(r=!0,t(l,function(f,p){r=!1,o?(s(o),n&&n(o)):f?c(f,s):s(null,p)}))})}}}});var we=h((Li,Ft)=>{var $n=N();function Mn(e){return e}Ft.exports=function(t){return typeof t=="object"&&typeof t.test=="function"?function(r){return t.test(r)}:$n(t)||Mn}});var ee=h((Di,Ot)=>{"use strict";var Un=we();Ot.exports=function(t){return t=Un(t),function(r){return function n(o,i){for(var c,u=!0;u;)u=!1,c=!0,r(o,function(s,a){if(!s&&!t(a))return c?u=!0:n(s,i);i(s,a)}),c=!1}}}});var Bt=h((Ni,bt)=>{"use strict";var Gn=we(),Jn=ee();bt.exports=function(t){return t=Gn(t),Jn(function(r){return!t(r)})}});var At=h(($i,Rt)=>{"use strict";Rt.exports=function(t,r){var n=!1;function o(i){n||!r||(n=!0,r(i===!0?null:i))}return function(i){return function(c,u){return c&&o(c),i(c,function(s,a){s?o(s):t&&t(a),u(s,a)})}}}});var Tt=h((Mi,It)=>{"use strict";It.exports=function(t,r){r=r||{};var n=r.last||!1,o=!1;if(typeof t=="number"){n=!0;var i=t;t=function(){return--i}}return function(c){function u(s){c(!0,function(a){n=!1,s(a||!0)})}return function(s,a){o&&!s?n?u(a):a(o):(o=s)?c(o,a):c(null,function(l,f){(o=o||l)?a(o):t(f)?a(null,f):(o=!0,n?a(null,f):u(a))})}}}});var Ce=h((Ui,Lt)=>{"use strict";function Hn(e){return e}var Wn=N(),Yn=ee();Lt.exports=function(t,r){t=Wn(t)||Hn;var n={};return Yn(function(o){var i=t(o);return n[i]?!!r:(n[i]=!0,!r)})}});var Nt=h((Gi,Dt)=>{"use strict";var jn=Ce();Dt.exports=function(t){return jn(t,!0)}});var Mt=h((Ji,$t)=>{"use strict";var zn=Q(),Vn=ye();$t.exports=function(){return function(t){var r;return function(n,o){n?r?r(n,function(u){t(u||n,o)}):t(n,o):r?i():c();function i(){r(null,function(u,s){u?u===!0?c():t(!0,function(a){o(u)}):o(null,s)})}function c(){r=null,t(null,function(u,s){if(u)return o(u);s&&typeof s=="object"?s=zn(s):typeof s!="function"&&(s=Vn(s)),r=s,i()})}}}}});var Gt=h((Hi,Ut)=>{"use strict";Ut.exports={map:St(),asyncMap:Pt(),filter:ee(),filterNot:Bt(),through:At(),take:Tt(),unique:Ce(),nonUnique:Nt(),flatten:Mt()}});var xe=h((Wi,Jt)=>{"use strict";Jt.exports=function e(t){var r=arguments.length;if(typeof t=="function"&&t.length===1){for(var n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return function(u){if(n==null)throw new TypeError("partial sink should only be called once!");var s=n;switch(n=null,r){case 1:return e(u,s[0]);case 2:return e(u,s[0],s[1]);case 3:return e(u,s[0],s[1],s[2]);case 4:return e(u,s[0],s[1],s[2],s[3]);default:return s.unshift(u),e.apply(null,s)}}}var i=t;i&&typeof i.source=="function"&&(i=i.source);for(var o=1;o<r;o++){var c=arguments[o];typeof c=="function"?i=c(i):c&&typeof c=="object"&&(c.sink(i),i=c.source)}return i}});var Y=h((B,jt)=>{"use strict";var Ht=st(),Wt=qt(),Yt=Gt();B=jt.exports=xe();B.pull=B;for(k in Ht)B[k]=Ht[k];var k;for(k in Yt)B[k]=Yt[k];var k;for(k in Wt)B[k]=Wt[k];var k});var Ee=h((rs,Vt)=>{var ts=Vt.exports=function(e){(function t(){var r=!0,n=!1,o=!1;do o=!0,r=!1,e.call(this,function(){o?r=!0:t()}),o=!1;while(r)})()}});var qe=h((O,Qt)=>{var ns=xe(),Kn=Ee();function Kt(e){e.destroy?e.destroy():console.error("warning, stream-to-pull-stream: \nthe wrapped node-stream does not implement `destroy`, \nthis may cause resource leaks.")}function Zt(e,t,r){var n,o=!1,i;function c(){i||(i=!0,r&&r(n===!0?null:n))}function u(){o||(o=!0,a(),n?c():e(n=!0,c))}function s(l){a(),n||e(n=l,c)}function a(){t.on("finish",u),t.removeListener("close",u),t.removeListener("error",s)}t.on("close",u),t.on("finish",u),t.on("error",s),process.nextTick(function(){Kn(function(l){e(null,function(f,p){if(n=n||f,f===!0)return t._isStdio?c():t.end();if(n=n||f)return Kt(t),c(n);if(t._isStdio)t.write(p,function(){l()});else{var d=t.write(p);d===!1?t.once("drain",l):l()}})})})}function Zn(e){var t=!1,r=!1,n;function o(){var i=e.read();if(i!==null&&n){var c=n;n=null,c(null,i)}}return e.on("readable",function(){r=!0,n&&o()}).on("end",function(){t=!0,n&&n(t)}).on("error",function(i){t=i,n&&n(t)}),function(i,c){n=c,t?c(t):r&&o()}}function te(e){var t=[],r=[],n,o=!1,i;function c(){for(;(t.length||n)&&r.length;)r.shift()(t.length?null:n,t.shift());!t.length&&o&&(o=!1,e.resume())}return e.on("data",function(u){t.push(u),c(),t.length&&e.pause&&(o=!0,e.pause())}),e.on("end",function(){n=!0,c()}),e.on("close",function(){n=!0,c()}),e.on("error",function(u){n=u,c()}),function(u,s){if(!s)throw new Error("*must* provide cb");if(u){let l=function(){for(;r.length;)r.shift()(u);s(u)};var a=l;if(n)return l();e.once("close",l),Kt(e)}else r.push(s),c()}}var Qn=te,re=function(e,t){return function(r){return Zt(r,e,t)}},ne=function(e){return te(e)};O=Qt.exports=function(e,t){return e.writable&&e.write?e.readable?function(r){return Zt(r,e,t),te(e)}:re(e,t):ne(e)};O.sink=re;O.source=ne;O.read=Qn;O.read1=te;O.read2=Zn;O.duplex=function(e,t){return{source:ne(e),sink:re(e,t)}};O.transform=function(e){return function(t){var r=ne(e);return re(e)(t),r}}});var nr=h((ss,rr)=>{var no=Ee();rr.exports=function(e,t){return function(r){var n=[],o,i;function c(a){n.push(a)}e=e||function(a){this.queue(a)},t=t||function(){this.queue(null)};var u={emit:function(a,l){a=="data"&&c(l),a=="end"&&(o=!0,c(null)),a=="error"&&(i=l)},queue:c},s;return function(a,l){if(o=o||a,a)return r(a,function(){if(s){var f=s;s=null,f(a)}l(a)});s=l,no(function f(p){if(!!s)if(l=s,i)s=null,l(i);else if(n.length){var d=n.shift();s=null,l(d===null,d)}else r(o,function(g,m){if(g&&g!==!0)return i=g,p();if(o=o||g)t.call(u);else if(m!==null&&(e.call(u,m),i||o))return r(i||o,function(){s=null,l(i||o)});p(f)})})}}}});var ir=h((us,or)=>{or.exports=function(){var e=[],t=0;function r(){return e.reduce(function(n,o){return n+o.length},0)}return{length:t,data:this,add:function(n){if(!Buffer.isBuffer(n))throw new Error("data must be a buffer, was: "+JSON.stringify(n));return this.length=t=t+n.length,e.push(n),this},has:function(n){return n==null?t>0:t>=n},get:function(n){var o;if(n==null||n===t){t=0;var i=e;return e=[],i.length==1?i[0]:Buffer.concat(i)}else if(e.length>1&&n<=(o=e[0].length)){var c=e[0].slice(0,n);return n===o?e.shift():e[0]=e[0].slice(n,o),t-=n,c}else if(n<t){for(var u=[],s=0;s+e[0].length<n;){var a=e.shift();s+=a.length,u.push(a)}return s<n&&(u.push(e[0].slice(0,n-s)),e[0]=e[0].slice(n-s,e[0].length),this.length=t=t-n),Buffer.concat(u)}else throw new Error("could not get "+n+" bytes")}}}});var lr=h((cs,cr)=>{"use strict";var oo=ir();function io(e){return Number.isFinite(e)}function sr(e){return typeof e=="function"}function ur(e,t){return t?function(r,n){var o=setTimeout(function(){e(new Error("pull-reader: read exceeded timeout"),n)},t);e(r,function(i,c){clearTimeout(o),n(i,c)})}:e}cr.exports=function(e){var t=[],r,n,o=!1,i=oo(),c,u,s;function a(){for(;t.length;)if(t[0].length==null&&i.has(1))t.shift().cb(null,i.get());else if(i.has(t[0].length)){var p=t.shift();p.cb(null,i.get(p.length))}else if(c==!0&&t[0].length&&i.length<t[0].length){var d="stream ended with:"+i.length+" but wanted:"+t[0].length;t.shift().cb(new Error(d))}else if(c)t.shift().cb(c);else return!!t.length;return t.length||!i.has(1)||s}function l(){var p=a();p&&!o&&r&&!o&&!u&&(o=!0,n(null,function(d,g){if(o=!1,d)return c=d,a();i.add(g),l()}))}function f(p){if(s){for(;t.length;)t.shift().cb(s);return cb&&cb(s)}n=ur(p,e),r=p,l()}return f.abort=function(p,d){s=p||!0,r?(o=!0,r(s,function(){for(;t.length;)t.shift().cb(s);d&&d(s)})):d()},f.read=function(p,d,g){if(sr(d)&&(g=d,d=e),sr(g))t.push({length:io(p)?p:null,cb:g}),l();else return u=!0,function(m,y){if(o||i.has(1)){if(m)return r(m,y);t.push({length:null,cb:y}),l()}else ur(r,d)(m,function(x,F){y(x,F)})}},f}});var ar=h((ls,fr)=>{var $=1e3,M=$*60,U=M*60,R=U*24,so=R*7,uo=R*365.25;fr.exports=function(e,t){t=t||{};var r=typeof e;if(r==="string"&&e.length>0)return co(e);if(r==="number"&&isFinite(e))return t.long?fo(e):lo(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function co(e){if(e=String(e),!(e.length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!!t){var r=parseFloat(t[1]),n=(t[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*uo;case"weeks":case"week":case"w":return r*so;case"days":case"day":case"d":return r*R;case"hours":case"hour":case"hrs":case"hr":case"h":return r*U;case"minutes":case"minute":case"mins":case"min":case"m":return r*M;case"seconds":case"second":case"secs":case"sec":case"s":return r*$;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function lo(e){var t=Math.abs(e);return t>=R?Math.round(e/R)+"d":t>=U?Math.round(e/U)+"h":t>=M?Math.round(e/M)+"m":t>=$?Math.round(e/$)+"s":e+"ms"}function fo(e){var t=Math.abs(e);return t>=R?ie(e,t,R,"day"):t>=U?ie(e,t,U,"hour"):t>=M?ie(e,t,M,"minute"):t>=$?ie(e,t,$,"second"):e+" ms"}function ie(e,t,r,n){var o=t>=r*1.5;return Math.round(e/r)+" "+n+(o?"s":"")}});var _e=h((fs,pr)=>{function ao(e){r.debug=r,r.default=r,r.coerce=s,r.disable=i,r.enable=o,r.enabled=c,r.humanize=ar(),r.destroy=a,Object.keys(e).forEach(l=>{r[l]=e[l]}),r.names=[],r.skips=[],r.formatters={};function t(l){let f=0;for(let p=0;p<l.length;p++)f=(f<<5)-f+l.charCodeAt(p),f|=0;return r.colors[Math.abs(f)%r.colors.length]}r.selectColor=t;function r(l){let f,p=null,d,g;function m(...y){if(!m.enabled)return;let x=m,F=Number(new Date),mn=F-(f||F);x.diff=mn,x.prev=f,x.curr=F,f=F,y[0]=r.coerce(y[0]),typeof y[0]!="string"&&y.unshift("%O");let Z=0;y[0]=y[0].replace(/%([a-zA-Z%])/g,(he,yn)=>{if(he==="%%")return"%";Z++;let Je=r.formatters[yn];if(typeof Je=="function"){let vn=y[Z];he=Je.call(x,vn),y.splice(Z,1),Z--}return he}),r.formatArgs.call(x,y),(x.log||r.log).apply(x,y)}return m.namespace=l,m.useColors=r.useColors(),m.color=r.selectColor(l),m.extend=n,m.destroy=r.destroy,Object.defineProperty(m,"enabled",{enumerable:!0,configurable:!1,get:()=>p!==null?p:(d!==r.namespaces&&(d=r.namespaces,g=r.enabled(l)),g),set:y=>{p=y}}),typeof r.init=="function"&&r.init(m),m}function n(l,f){let p=r(this.namespace+(typeof f>"u"?":":f)+l);return p.log=this.log,p}function o(l){r.save(l),r.namespaces=l,r.names=[],r.skips=[];let f,p=(typeof l=="string"?l:"").split(/[\s,]+/),d=p.length;for(f=0;f<d;f++)!p[f]||(l=p[f].replace(/\*/g,".*?"),l[0]==="-"?r.skips.push(new RegExp("^"+l.slice(1)+"$")):r.names.push(new RegExp("^"+l+"$")))}function i(){let l=[...r.names.map(u),...r.skips.map(u).map(f=>"-"+f)].join(",");return r.enable(""),l}function c(l){if(l[l.length-1]==="*")return!0;let f,p;for(f=0,p=r.skips.length;f<p;f++)if(r.skips[f].test(l))return!1;for(f=0,p=r.names.length;f<p;f++)if(r.names[f].test(l))return!0;return!1}function u(l){return l.toString().substring(2,l.toString().length-2).replace(/\.\*\?$/,"*")}function s(l){return l instanceof Error?l.stack||l.message:l}function a(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}pr.exports=ao});var dr=h((E,se)=>{E.formatArgs=ho;E.save=go;E.load=mo;E.useColors=po;E.storage=yo();E.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();E.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function po(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function ho(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+se.exports.humanize(this.diff),!this.useColors)return;let t="color: "+this.color;e.splice(1,0,t,"color: inherit");let r=0,n=0;e[0].replace(/%[a-zA-Z%]/g,o=>{o!=="%%"&&(r++,o==="%c"&&(n=r))}),e.splice(n,0,t)}E.log=console.debug||console.log||(()=>{});function go(e){try{e?E.storage.setItem("debug",e):E.storage.removeItem("debug")}catch{}}function mo(){let e;try{e=E.storage.getItem("debug")}catch{}return!e&&typeof process<"u"&&"env"in process&&(e=process.env.DEBUG),e}function yo(){try{return localStorage}catch{}}se.exports=_e()(E);var{formatters:vo}=se.exports;vo.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}});var gr=h((as,hr)=>{"use strict";hr.exports=(e,t)=>{t=t||process.argv;let r=e.startsWith("-")?"":e.length===1?"-":"--",n=t.indexOf(r+e),o=t.indexOf("--");return n!==-1&&(o===-1?!0:n<o)}});var yr=h((ps,mr)=>{"use strict";var wo=require("os"),S=gr(),C=process.env,G;S("no-color")||S("no-colors")||S("color=false")?G=!1:(S("color")||S("colors")||S("color=true")||S("color=always"))&&(G=!0);"FORCE_COLOR"in C&&(G=C.FORCE_COLOR.length===0||parseInt(C.FORCE_COLOR,10)!==0);function Co(e){return e===0?!1:{level:e,hasBasic:!0,has256:e>=2,has16m:e>=3}}function xo(e){if(G===!1)return 0;if(S("color=16m")||S("color=full")||S("color=truecolor"))return 3;if(S("color=256"))return 2;if(e&&!e.isTTY&&G!==!0)return 0;let t=G?1:0;if(process.platform==="win32"){let r=wo.release().split(".");return Number(process.versions.node.split(".")[0])>=8&&Number(r[0])>=10&&Number(r[2])>=10586?Number(r[2])>=14931?3:2:1}if("CI"in C)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some(r=>r in C)||C.CI_NAME==="codeship"?1:t;if("TEAMCITY_VERSION"in C)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(C.TEAMCITY_VERSION)?1:0;if(C.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in C){let r=parseInt((C.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(C.TERM_PROGRAM){case"iTerm.app":return r>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(C.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(C.TERM)||"COLORTERM"in C?1:(C.TERM==="dumb",t)}function Pe(e){let t=xo(e);return Co(t)}mr.exports={supportsColor:Pe,stdout:Pe(process.stdout),stderr:Pe(process.stderr)}});var wr=h((w,ce)=>{var Eo=require("tty"),ue=require("util");w.init=Oo;w.log=_o;w.formatArgs=ko;w.save=Po;w.load=Fo;w.useColors=qo;w.destroy=ue.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");w.colors=[6,2,3,4,5,1];try{let e=yr();e&&(e.stderr||e).level>=2&&(w.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}w.inspectOpts=Object.keys(process.env).filter(e=>/^debug_/i.test(e)).reduce((e,t)=>{let r=t.substring(6).toLowerCase().replace(/_([a-z])/g,(o,i)=>i.toUpperCase()),n=process.env[t];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),e[r]=n,e},{});function qo(){return"colors"in w.inspectOpts?Boolean(w.inspectOpts.colors):Eo.isatty(process.stderr.fd)}function ko(e){let{namespace:t,useColors:r}=this;if(r){let n=this.color,o="\x1B[3"+(n<8?n:"8;5;"+n),i=`  ${o};1m${t} \x1B[0m`;e[0]=i+e[0].split(`
`).join(`
`+i),e.push(o+"m+"+ce.exports.humanize(this.diff)+"\x1B[0m")}else e[0]=So()+t+" "+e[0]}function So(){return w.inspectOpts.hideDate?"":new Date().toISOString()+" "}function _o(...e){return process.stderr.write(ue.format(...e)+`
`)}function Po(e){e?process.env.DEBUG=e:delete process.env.DEBUG}function Fo(){return process.env.DEBUG}function Oo(e){e.inspectOpts={};let t=Object.keys(w.inspectOpts);for(let r=0;r<t.length;r++)e.inspectOpts[t[r]]=w.inspectOpts[t[r]]}ce.exports=_e()(w);var{formatters:vr}=ce.exports;vr.o=function(e){return this.inspectOpts.colors=this.useColors,ue.inspect(e,this.inspectOpts).split(`
`).map(t=>t.trim()).join(" ")};vr.O=function(e){return this.inspectOpts.colors=this.useColors,ue.inspect(e,this.inspectOpts)}});var Oe=h((ds,Fe)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?Fe.exports=dr():Fe.exports=wr()});var Br=h((A,br)=>{var bo=nr(),Bo=lr(),Cr=Oe(),xr=0,Er=1,qr=2,kr="GOODBYE";function Sr(e){let t=Buffer.alloc(9),r=0,n=e.value!==void 0?e.value:e.end;return typeof e=="string"&&e===kr?(t.fill(0),[t,null]):(typeof n=="string"?(r=Er,n=Buffer.from(n,"utf-8")):Buffer.isBuffer(n)?r=xr:(r=qr,n=Buffer.from(JSON.stringify(n),"utf-8")),r=e.stream<<3|e.end<<2|r,t[0]=r,t.writeUInt32BE(n.length,1),t.writeInt32BE(e.req||0,5),[t,n])}function _r(e){if(e.length!==9)throw new Error("expected header to be 9 bytes long");let t=e[0],r=e.readUInt32BE(1);return{req:e.readInt32BE(5),stream:!!(t&8),end:!!(t&4),value:null,length:r,type:t&3}}function Pr(e,t){if(e.length!==t.length)throw new Error("incorrect length, expected:"+t.length+" found:"+e.length);if(t.type===xr)t.value=e;else if(t.type===Er)t.value=e.toString();else if(t.type===qr)t.value=JSON.parse(e.toString());else throw new Error("unknown message type");return t}function Fr(e){return bo(function(r){e&&e("encoded: %o",r);let[n,o]=Sr(r);this.queue(n),o!==null&&this.queue(o)})}function Or(e){let t=Bo(),r=!1;return function(o){return t(o),function(c,u){if(r)return u(!0);if(c)return t.abort(c,u);t.read(9,function(a,l){if(a)return u(a);let f=_r(l);if(f.length===0)return r=!0,u(null,kr);t.read(f.length,function(d,g){if(d)return u(d);try{Pr(g,f)}catch(m){return u(m)}e&&e("decoded: %o",f),u(null,f)})})}}}A=br.exports=function(t,r){let n=r===!0?Cr("packet-stream-codec"):typeof r=="string"?Cr(r):null;return{source:Fr(n)(t.source),sink(o){return t.sink(Or(n)(o))}}};A.encodePair=Sr;A.decodeHead=_r;A.decodeBody=Pr;A.encode=Fr;A.decode=Or});var be=h((hs,Rr)=>{function Ro(e){return e&&(e===!0?!0:{message:e.message,name:e.name,stack:e.stack})}function Ao(e){console.error("packet-stream asked to read after closed",e)}Rr.exports={flat:Ro,closedread:Ao}});var Tr=h((gs,Ir)=>{var{flat:Ar,closedread:Io}=be();function le(e,t,r){this.id=e,this.read=null,this.writeEnd=null,this.readEnd=null,this._ps=t,this._remove=r}le.prototype.write=function(e,t){let r=this._ps;t?(this.writeEnd=t,r&&(r.read({req:this.id,stream:!0,end:!0,value:Ar(t)}),this.readEnd&&this.destroy(t),r._maybedone(t))):r&&r.read({req:this.id,stream:!0,end:!1,value:e})};le.prototype.end=function(e){this.write(null,Ar(e||!0))};le.prototype.destroy=function(e){if(this.writeEnd){if(!this.readEnd){this.readEnd=!0;try{this.read&&this.read(null,e)}catch(t){console.error("Exception thrown by PacketStream substream end handler",t),console.error(t.stack)}}}else{if(this.writeEnd=!0,!this.readEnd){this.readEnd=!0;try{this.read(null,e)}catch(t){console.error("Exception thrown by PacketStream substream end handler",t),console.error(t.stack)}}this.write(null,e)}this._ps&&(this._remove(),this._remove=null,this.read=Io,this._ps=null)};Ir.exports=le});var Nr=h((ms,Dr)=>{var Lr=Tr(),{flat:Be,closedread:To}=be();function q(e){this.ended=!1,this.opts=e,this._req_counter=1,this._requests=new Map,this._instreams=new Map,this._outstreams=new Map,this._closecbs=[],this._closing=!1,this._closed=!1,e.close&&this._closecbs.push(e.close)}q.prototype.message=function(e){this.read({req:0,stream:!1,end:!1,value:e})};q.prototype.request=function(e,t){if(this._closing)return t(new Error("parent stream is closing"));let r=this._req_counter++;this._requests.set(r,(n,o)=>{this._requests.delete(r),t(n,o),this._maybedone(n)}),this.read({req:r,stream:!1,end:!1,value:e})};q.prototype.stream=function(){if(this._closing)throw new Error("parent stream is closing");let e=this._req_counter++,t=new Lr(e,this,()=>{this._outstreams.delete(e)});return this._outstreams.set(e,t),t};q.prototype.close=function(e){if(!e)throw new Error("packet-stream.close *must* have callback");if(this._closed)return e();this._closecbs.push(e),this._closing=!0,this._maybedone()};q.prototype.destroy=function(e){e=e||Be(e),this.ended=e,this._closing=!0;let t=e===!0?new Error("unexpected end of parent stream"):e,r=0;this._requests.forEach(n=>{r++,n(t)}),this._instreams.forEach(n=>{r++,n.writeEnd=!0,n.destroy(t)}),this._outstreams.forEach(n=>{r++,n.writeEnd=!0,n.destroy(t)}),r===0&&e===!0&&(t=null),this._maybedone(t)};q.prototype._maybedone=function(e){this._closed||!this._closing||this._requests.size!==0||this._instreams.size!==0||this._outstreams.size!==0||(this.read(null,e||!0),this._closed=!0,this._closecbs.forEach(t=>{t(e)}),this.opts=null,this._closecbs.length=0,this.read=To,this._requests.clear(),this._instreams.clear(),this._outstreams.clear())};q.prototype.read=function(e){console.error("please overwrite read method to do IO",e)};q.prototype.write=function(e,t){this.ended||(t?this.destroy(t):e.req&&!e.stream?this._onrequest(e):e.req&&e.stream?this._onstream(e):this._onmessage(e))};q.prototype._onmessage=function(e){this.opts&&typeof this.opts.message=="function"&&this.opts.message(e.value)};q.prototype._onrequest=function(e){let t=e.req*-1;if(e.req<0)this._requests.has(t)&&this._requests.get(t)(e.end?e.value:null,e.end?null:e.value);else if(this.opts&&typeof this.opts.request=="function"){let r=!1;this.opts.request(e.value,(n,o)=>{if(r)throw new Error("cb called twice from local api");r=!0,n?this.read({value:Be(n),end:!0,req:t}):this.read({value:o,end:!1,req:t}),this._maybedone()})}else{if(this.ended){let r=this.ended===!0?new Error("unexpected end of parent stream"):this.ended;this.read({value:Be(r),end:!0,stream:!1,req:t})}else this.read({value:{message:"Unable to handle requests",name:"NO_REQUEST_HANDLER",stack:null},end:!0,stream:!1,req:t});this._maybedone()}};q.prototype._onstream=function(e){if(e.req<0){let t=e.req*-1,r=this._outstreams.get(t);if(!r)return console.error("no stream for incoming msg",e);e.end?(r.writeEnd&&this._outstreams.delete(t),r.readEnd=!0,r.read(null,e.value),this._maybedone()):r.read(e.value)}else{let t=e.req,r=this._instreams.get(t);r||(r=new Lr(t*-1,this,()=>{this._instreams.delete(t)}),this._instreams.set(t,r),this.opts&&typeof this.opts.stream=="function"&&this.opts.stream(r)),e.end?(r.writeEnd&&this._instreams.delete(t),r.readEnd=!0,r.read&&r.read(null,e.value),this._maybedone()):r.read?r.read(e.value):console.error("no .read for stream:",r.id,"dropped:",e)}};Dr.exports=e=>new q(e)});var Mr=h((ys,z)=>{"use strict";var Lo=Y();function Do(e){let t=!1;return(r,n)=>{t||(t=!0,e(r,n))}}function Re(e,t){let r=[],n=!1,o=!1,i,c,u=Do((s,a)=>{t&&t(s,a),e=null,t=null,i=null,c&&c(s||!0,()=>{})});return e.read=function(s,a){if(n=n||a,i){let l=i;i=null,l(n,s)}else!n&&!o&&r.push(s);n&&u(n!==!0?n:null)},{source(s,a){s?(e&&e.write(null,s),a(s),r.length=0,o=!0,u(s!==!0?s:null)):r.length?a(null,r.shift()):n?a(n):i=a},sink(s){if(n)return c=null,s(n,()=>{});c=s,Lo.drain(a=>{if(n)return!1;e.write(a)},a=>{e&&!e.writeEnd&&e.write(null,a||!0),u&&u(a)})(s)}}}function $r(e,t){return Re(e,r=>{e.writeEnd||e.write(null,r||!0),t&&t(r)})}function No(e){return $r(e).source}function $o(e,t){return $r(e,t).sink}z.exports=Re;z.exports.source=No;z.exports.sink=$o;z.exports.duplex=Re});var Gr=h((vs,Ur)=>{Ur.exports=function(t){var r,n,o;function i(c){return function(u,s){c(u,function(a,l){if(a&&!o)return o=!0,s(null,t);a&&r?s(a):a?n=s:s(null,l)})}}return i.end=function(){return r=!0,n&&n(r),i},i}});var Hr=h((ws,Jr)=>{var Mo=Gr(),Ae=Y();Jr.exports=function(e,t){t=t||"GOODBYE";var r=Mo(t);return{source:Ae(e.source,r),sink:Ae(Ae.filter(function(n){if(n!==t)return!0;r.end()}),e.sink)}}});var V=h(_=>{"use strict";var fe=Y();function Uo(e){return e?Object.keys(e).length===0:!0}_.set=function(t,r,n){let o,i;for(let c=0;c<r.length;c++){let u=r[c];t[u]=t[u]||{},o=t,i=u,t=t[u]}o[i]=n};_.get=function(t,r){if(typeof r=="string")return t[r];let n;for(let o=0;o<r.length;o++){let i=r[o];if(n=t=t[i],t==null)return t}return n};_.prefix=function(t,r){let n;for(let o=0;o<r.length;o++){let i=r[o];if(n=t=t[i],typeof t!="object")return t}return typeof n!="object"?!!n:!1};function Go(e,t){for(let r in t){let n=t[r];e[n]||(e[n]={}),e=e[n]}return e}function Jo(e,t){(function r(n,o){let i=t[o];if(n)t.length-1===o?delete n[i]:o<t.length&&r(n[i],o+1);else return;Uo(n[i])&&delete n[i]})(e,0)}function Ho(e,t){for(let r in t)e[r]=t[r];return e}_.mount=function(t,r,n){if(!Array.isArray(r))throw new Error("path must be array of strings");return Ho(Go(t,r),n)};_.unmount=function(t,r){return Jo(t,r)};var ae=e=>e==="source",pe=e=>e==="sink",Ie=e=>e==="duplex",Wo=e=>e==="sync",Yo=e=>e==="async",Wr=e=>Wo(e)||Yo(e),jo=e=>ae(e)||pe(e)||Ie(e);_.isRequest=Wr;_.isStream=jo;function Te(e){return function(t){t(e||!0,()=>{})}}function Yr(e){return{source:fe.error(e),sink:Te(e)}}_.errorAsStream=function(t,r){return ae(t)?fe.error(r):pe(t)?Te(r):Yr(r)};_.errorAsStreamOrCb=function(t,r,n){return Wr(t)?n(r):Ie(t)?Yr(r):ae(t)?fe.error(r):pe(t)?Te(r):n(r)};_.pipeToStream=function(t,r,n){ae(t)?r(n):pe(t)?n(r):Ie(t)&&fe(r,n,r)}});var Le=h((xs,jr)=>{"use strict";function zo(e){return typeof e=="string"?[`Error: ${e}`]:e.stack?e.stack.split(`
`):[`${e.name}: ${e.message}`]}jr.exports=function(t,r){let n=new Error(r),o=n.stack.split(`
`);o.splice(1,1);let i=zo(t);i[0]="  "+i[0];for(let c=1;c<o.length;c++)if(i.includes(o[c])){o.splice(c);break}return n.stack=o.concat(i).join(`
`),n}});var Zr=h((Es,Kr)=>{"use strict";var Vo=Nr(),De=Mr(),Ko=Hr(),J=V(),zr=Le(),Vr=Oe()("muxrpc:psc");Kr.exports=function(t,r,n){let o=Vo({message(){},request(c,u){if(!Array.isArray(c.args))return u(new Error(`invalid request, args should be array, was: ${JSON.stringify(c)}`));let s=c.name,a=c.args,l=!1,f=!1;a.push((p,d)=>{f=!0,l=!0,u(p,d)});try{t("async",s,a)}catch(p){if(l||f)throw zr(p,"no callback provided to muxrpc async funtion");u(p)}},stream(c){c.read=function(s,a){if(a)return c.write(null,a);let{name:l,type:f,args:p}=s,d,g;if(c.read=null,!J.isStream(f))return c.write(null,new Error(`unsupported stream type: ${f}`));try{g=t(f,l,p)}catch(x){d=x}let y=De[f==="source"?"sink":f==="sink"?"source":"duplex"](c);return J.pipeToStream(f,y,d?J.errorAsStream(f,d):g)}},close(c){if(o=null,i.ended=!0,!i.closed&&(i.closed=!0,n)){let u=n;n=null,u(c)}}}),i=Ko(De(o,()=>{}));return i=r?r(i,Vr.enabled?Vr.namespace:!1):i,i.remoteCall=function(c,u,s,a){if(u==="emit")return o.message(s);if(!(J.isRequest(c)||J.isStream(c)))throw new Error(`unsupported type: ${JSON.stringify(c)}`);if(J.isRequest(c))return o.request({name:u,args:s},a);let l=o.stream(),f=De[c](l,a);return l.write({name:u,args:s,type:c}),f},i.isOpen=function(){return!o.ended},i.close=function(c,u){if(typeof c=="function"&&(u=c,c=!1),!o){u&&u();return}if(c){o.destroy(c),u&&u();return}return o.close(s=>{if(u)u(s);else if(s)throw zr(s,"no callback provided for muxrpc close")}),this},i.closed=!1,i}});var Xr=h((qs,Qr)=>{"use strict";var Zo=Le(),Qo=V();function Ne(e,t,r,n){for(let o in t){let i=t[o],c=r?r.concat(o):[o];if(i&&typeof i=="object"){let u=i;e[o]=Ne({},u,c,n)}else{let u=i;e[o]=(...s)=>n(u,c,s)}}return e}function Xo(e){if(e)throw Zo(e,"callback not provided")}function ei(e,t,r,n){e=e||{};function o(i,c,u){let s=typeof u[u.length-1]=="function"?u.pop():i==="sync"||i==="async"?null:Xo;if(typeof s=="function"){let a;try{a=r(i,c,u,s)}catch(l){return Qo.errorAsStreamOrCb(i,l,s)}return a}else return new Promise((a,l)=>{r(i,c,u,(f,p)=>{f?l(f):a(p)})})}return n?o("async","manifest",[function(i,c){if(i)return n(i);Ne(e,c,null,o),n(null,c,e)}]):Ne(e,t,null,o),e}Qr.exports=ei});var rn=h((ks,tn)=>{"use strict";var de=V();function en(e){return Array.isArray(e)?e:e.split(".")}function ti(e){return e&&typeof e.pre=="function"&&typeof e.test=="function"&&typeof e.post=="function"}tn.exports=function(t){if(ti(t))return t;if(typeof t=="function")return{pre:t};let r=null,n={};function o(i){if(i.allow){r={};for(let c of i.allow)de.set(r,en(c),!0)}else r=null;if(i.deny)for(let c of i.deny)de.set(n,en(c),!0);else n={};return this}return t&&o(t),o.pre=i=>{if(i=Array.isArray(i)?i:[i],r&&!de.prefix(r,i))return new Error(`method:${i} is not in list of allowed methods`);if(n&&de.prefix(n,i))return new Error(`method:${i} is on list of disallowed methods`)},o.post=()=>{},o.test=i=>o.pre(i),o.get=()=>({allow:r,deny:n}),o}});var on=h((Ss,nn)=>{"use strict";var ri=rn(),$e=V();nn.exports=function(t,r,n){n=ri(n);function o(c,u){return c===$e.get(r,u)}function i(c,u,s){if(u==="emit")throw new Error("emit has been removed");if(c==="async"&&o("sync",u)){let a=s.pop(),l;try{l=$e.get(t,u).apply(this,s)}catch(f){return a(f)}return a(null,l)}if(!o(c,u))throw new Error(`no ${c}:${u}`);return $e.get(t,u).apply(this,s)}return function(u,s,a){let l=n.pre(s,a);if(l)throw l;return i.call(this,u,s,a)}}});var cn=h((_s,un)=>{"use strict";var ni=Br(),oi=require("events").EventEmitter,ii=Zr(),si=Xr(),ui=on();function sn(e,t,r,n,o,i,c){let u;typeof e=="function"&&(u=e,e={}),t=t||{},e=e||{};let s=new oi;i||(i=ni);let a,l={_emit(p,d){return s&&s._emit(p,d),l},id:n},f=ii(ui(r,t,o).bind(l),i,p=>{if(!s.closed&&(s.closed=!0,s.emit("closed"),a)){let d=a;a=null,d(p)}});if(si(s,e,(p,d,g,m)=>{if(f.closed)throw new Error("stream is closed");return f.remoteCall(p,d,g,m)},u),s._emit=s.emit,c){Object.__defineGetter__.call(s,"id",()=>l.id),Object.__defineSetter__.call(s,"id",d=>{l.id=d});let p=!0;s.createStream=d=>{if(a=d,p)return p=!1,f;throw new Error("one stream per rpc")}}else s.stream=f;return s.closed=!1,s.close=function(p,d){return f.close(p,d),this},s}un.exports=function(e,t,r){return arguments.length>3?sn.apply(this,arguments):function(n,o,i){return sn(e,t,n,i,o,r,!0)}}});var pi={};module.exports=kn(pi);var fn=b(require("net")),an=b(require("http")),W=b(require("fs")),pn=b(require("path")),Me=b(require("child_process")),Ge=b(Y()),Ue=require("util");var j=b(require("net"));var v=b(require("fs")),P=require("util");var zt=(0,P.promisify)(v.readFile),Yi=(0,P.promisify)(v.writeFile),ji=(0,P.promisify)(v.appendFile),zi=(0,P.promisify)(v.rename),Vi=(0,P.promisify)(v.readdir),Ki=(0,P.promisify)(v.unlink);var Zi=(0,P.promisify)(v.rmdir),Qi=(0,P.promisify)(v.rm),Xi=(0,P.promisify)(v.copyFile);var ke=qe(),Xt=e=>{if("port"in e)return ke.duplex(j.connect(e.port,e.host));let t=e.socketPath;if(process.platform!=="win32"||t.startsWith("\\\\.\\pipe\\"))return ke.duplex(j.connect(t));let r=new j.Socket;return to(r,t)};function Xn(e){let t=[];return e.split("-").map(r=>{let n=r.match(/.{2}/g);n!==null&&n.reverse().map(o=>{t.push(parseInt(o,16))})}),Buffer.from(t)}function eo(e,t,r){return t||r===void 0?{headerSize:e,err:t}:e===0?{headerSize:e,data:r}:r.length>e?(r=r.slice(e,r.length),e=0,{headerSize:e,data:r}):(e=e-r.length,{headerSize:e})}function to(e,t){let r=0,n=[],o=[],i,c=l=>{l instanceof Error&&console.error(l),e.destroy();for(let f of n)f.cb(l,void 0);n=[];for(let f of o)f(l,(p,d)=>{});o=[]};function u(l,f){i.source(l,function(p,d){let g=eo(r,p,d);r=g.headerSize,g.err||g.data?f(g.err||null,g.data):u(l,f)})}return(async()=>{let l=await zt(t),p=l.toString().match(/!<socket >(\d+)( s)? ((([A-Fa-f0-9]{2}){4}-?){4})/),d,g;if(p!==null){let m=p[1],y=p[3];d=parseInt(m,10);let x=Xn(y),F=Buffer.alloc(12);F.writeUInt32LE(process.pid,0),g=Buffer.concat([x,F]),r=16+3*4}else{let m=l.indexOf(10);d=parseInt(l.slice(0,m).toString(),10),g=l.slice(m+1),r=0}e.on("error",m=>{c(m)}),e.connect(d,"127.0.0.1",()=>{e.write(g,m=>{if(!m){i=ke.duplex(e);for(let y of n)u(y.abort,y.cb);n=[];for(let y of o)i.sink(y);o=[]}})})})().catch(l=>{c(l)}),{source:function(l,f){i!==void 0?u(l,f):n.push({abort:l,cb:f})},sink:function(l){i!==void 0?i.sink(l):o.push(l)}}}var oe=!1;function er(e,t,r){return oe?function(o){return Se(e(o),`${t} ${JSON.stringify(o)}`,r)}:e}function Se(e,t,r){return oe?{source:tr(e.source,`${t} Source`,r),sink:ro(e.sink,`${t} Sink`,r)}:e}function tr(e,t,r){return oe?function(o,i){r.write(`${t} end in (${typeof o}${o&&typeof o=="object"?`: ${Object.keys(o)}`:""}): ${o&&typeof o=="object"&&o.stack||o}`),e(o,function(u,s){r.write(`${t} end out (${typeof u}${u&&typeof u=="object"?`: ${Object.keys(u)}`:""}): ${u&&typeof u=="object"&&u.stack||u}`),r.write(`${t} data: ${s==null?void 0:s.toString("hex")}`),i(u,s)})}:e}function ro(e,t,r){return oe?function(o){e(tr(o,t,r))}:e}var ci=cn(),H=qe(),dn;try{dn=require(`${pn.dirname(process.argv[0])}/node_modules/node-pty`)}catch{}var hn=JSON.parse(process.env.REMOTE_CONTAINERS_SOCKETS),li={...hn.reduce((e,t)=>(e[t]="duplex",e),{}),rpc:"async",connected:"async",ready:"async"},fi={exec:"async",stdin:"sink",stdout:"source",stderr:"source",exit:"async",terminate:"async",dispose:"async",ptyExec:"async",ptyIn:"sink",ptyOut:"source",ptyResize:"async",ptyExit:"async",ptyTerminate:"async",ptyDispose:"async",execToEnd:"async",setBaseEnv:"async",connect:"duplex"},I=process.env,T={},L={},ln=0,K=ci(li,fi)({exec:(e,t)=>{let r=e.cwd,n=e.env?{...I,...e.env}:I,o=Me.spawn(e.cmd,e.args,{cwd:r,env:n,windowsHide:!0}),i=ln++;T[i]={process:o,exit:new Promise((c,u)=>{o.once("error",u),o.once("close",(s,a)=>{c({code:s,signal:a})})}),stdin:H.sink(o.stdin),stdout:H.source(o.stdout),stderr:H.source(o.stderr)},t(null,i)},stdin:e=>T[e].stdin,stdout:e=>T[e].stdout,stderr:e=>T[e].stderr,exit:(e,t)=>{T[e].exit.then(r=>t(null,r),t)},terminate:(e,t)=>{T[e].process.kill("SIGKILL"),t()},dispose:(e,t)=>{delete T[e],t()},ptyExec:(e,t)=>{let{cwd:r,cols:n,rows:o}=e,i=e.env?{...I,...e.env}:I,c=dn.spawn(e.cmd,e.args||[],{cwd:r,env:i,cols:n,rows:o}),u=[],s,a=c.onData(f=>{if(s){let p=s;s=void 0,p(null,f)}else u.push(f)}),l=ln++;L[l]={process:c,exit:new Promise(f=>{c.onExit(({exitCode:p,signal:d})=>f({code:p,signal:d}))}),in:f=>{f(null,function p(d,g){if(d!==!0){if(d)throw d;c.write(g),f(null,p)}})},out:(f,p)=>{if(f)return a.dispose(),u.length=0,p(f);if(u.length){let d=u.join("");u.length=0,p(null,d)}else s=p}},t(null,l)},ptyIn:e=>L[e].in,ptyOut:e=>L[e].out,ptyResize:(e,t,r,n)=>{L[e].process.resize(t,r),n()},ptyExit:(e,t)=>{L[e].exit.then(r=>t(null,r),t)},ptyTerminate:(e,t)=>{L[e].process.kill("SIGKILL"),t()},ptyDispose:(e,t)=>{delete L[e],t()},execToEnd:(e,t)=>{let r=e.cwd,n=e.env?{...I,...e.env}:I,o=Me.spawn(e.cmd,e.args,{cwd:r,env:n,windowsHide:!0}),i=[];o.stdout.on("data",u=>i.push(u));let c=[];o.stderr.on("data",u=>c.push(u)),o.once("error",t),o.once("close",(u,s)=>{t(null,{stdout:Buffer.concat(i),stderr:Buffer.concat(c),code:u,signal:s})})},setBaseEnv:(e,t)=>{I=e,t()},connect:er(Xt,"Remote Connect",{write:console.error})});(0,Ge.default)(H.source(process.stdin),K.createStream(),H.sink(process.stdout));var gn=hn.map(async e=>{try{if(!(await(0,Ue.promisify)(W.lstat)(e)).isSocket())return;await(0,Ue.promisify)(W.unlink)(e)}catch(r){if(!(r&&r.code==="ENOENT"))throw r}let t=fn.createServer(r=>{r=Se(H.duplex(r),"Remote Listener",{write:console.error}),(0,Ge.default)(r,ai,K[e](n=>{n&&console.error("Remote to local stream terminated with error:",n)}),r)});return new Promise(r=>t.listen(e,r))});function ai(e){return(t,r)=>{e(t,(n,o)=>{typeof n=="object"&&(n==null?void 0:n.code)==="ECONNRESET"&&(n=!0),r(n,o)})}}if(process.env.REMOTE_CONTAINERS_IPC){let e;gn.push(new Promise(t=>e=t)),an.createServer((t,r)=>{let n=[];t.on("data",o=>n.push(o)),t.on("end",()=>{K.rpc(Buffer.concat(n).toString(),(o,i)=>{o?(console.error(o),r.writeHead(500),r.end()):(r.writeHead(200),r.write(i,c=>{c&&console.error(c)}),r.end())})})}).listen(process.env.REMOTE_CONTAINERS_IPC,e)}Promise.all(gn).then(()=>K.ready(e=>{e&&console.error(e)})).catch(e=>console.error(e));K.connected(e=>{e&&console.error(e)});process.on("uncaughtException",e=>{W.writeSync(process.stderr.fd,String(e&&(e.stack||e.message)||e))});
//# sourceMappingURL=remoteContainersServer.js.map
